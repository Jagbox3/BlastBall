<html>
  
  <head>
    <title>Blast Ball</title>
    
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>

  <canvas id="myCanvas" width="window.innerWidth" height="window.innerHeight" style="border:1px solid       
  #d3d3d3;" onmousemove="move(event)">
  Your browser does not support the HTML5 canvas tag.</canvas>
  
  <script>
  var gameState;
  var canvas = document.getElementById("myCanvas");
  var timerID;
  
  var bomb;
  var thisPlayer;
  var ctx;
  
  initObjects();
  init();
  
  function init(){
    //canvas init
    canvas.id     = "canvas";
    canvas.width  = window.innerWidth - 20;
    canvas.height = window.innerHeight - 20;
    document.body.appendChild(canvas);
    ctx = canvas.getContext("2d");
    draw();
    
    //init bomb movement
    bomb.xVel = Math.random() * bomb.multiplier;
    bomb.yVel = Math.random();
    if(bomb.yVel <= .5){
      bomb.yVel *= -1;
    }
    bomb.yVel *= 10;
    
    //start game
    timerID = setInterval(function(){
      manageHitboxes();
      moveCircle();
      draw();
      timeCounter();
    }, 5);
    
    gameState.init = true;
    console.log("Initialized");
  }
  
  function timeCounter(){
    gameState.score += .1;
    if(gameState.score % 25 <= 0.4 && thisPlayer.size <= 200){
      thisPlayer.size += 1;
      console.log("howdy");
    }
  }

  function move(event){ //Player movement
    if(gameState.init){
      thisPlayer.x = event.clientX;
      thisPlayer.y = event.clientY;
    }
  }
  
  function moveCircle(){ //Bomb movement
    bomb.x += bomb.xVel;
    bomb.y += bomb.yVel;
  }
  
  function manageHitboxes(){
    if(bomb.x <= 0){
      bomb.xVel = Math.random() * bomb.multiplier;
      console.log("Left of screen");
    } else if (bomb.x + (bomb.diameter/2) >= canvas.width){
      bomb.xVel = Math.random() * -bomb.multiplier;
      console.log("Right of Screen");
    }
    if(bomb.y <= 0){
      bomb.yVel = Math.random() * bomb.multiplier;
      console.log("Top of screen");
    } else if(bomb.y + (bomb.diameter/2) >= canvas.height){
      bomb.yVel = Math.random() * -bomb.multiplier;
      console.log("Bottom of screen");
    }
    if( !(
      ( ( thisPlayer.y + thisPlayer.size ) < ( bomb.y ) ) ||
  		( thisPlayer.y > ( bomb.y + bomb.diameter ) ) ||
  		( ( thisPlayer.x + thisPlayer.size ) < bomb.x ) ||
  		( thisPlayer.x > ( bomb.x + bomb.diameter ) ) 
  		) ) {
  		  //Game over
  		  clearInterval(timerID);
  		  gameState.init = false;
  		  var roundedScore = Math.round(gameState.score)
    		var playAgain = confirm("Your score was " + roundedScore + ". Play again?");
    		if(playAgain){
    		  initObjects();
    		  init();
    		}
      }
  }
  
  function draw(){
    //Grey Background
    ctx.fillStyle = "#C0C0C0";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    //Bomb
    ctx.fillStyle = "#0000FF";
    ctx.beginPath();
    ctx.arc(bomb.x, bomb.y, bomb.diameter, 0, bomb.maths);
    ctx.fill();
    ctx.closePath();
    //This player
    ctx.fillStyle = "#FF0000"
    ctx.fillRect(thisPlayer.x - (thisPlayer.size / 2), thisPlayer.y - (thisPlayer.size / 2), thisPlayer.size, thisPlayer.size);
  }
  
  function initObjects(){
    gameState = {
      init: false,
      over: false,
      score: 0
    };
    bomb = {
      x: window.innerWidth / 2, y: window.innerHeight / 2,
      maths: 2 * Math.PI, diameter: 40,
      xVel: 0, yVel: 0, multiplier: 25
    };
    
    thisPlayer = {
      x: 0, y: 0, size: 50
    };
  }
    
  </script>
  
  </body>

</html>
